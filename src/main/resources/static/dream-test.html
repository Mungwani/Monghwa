<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ëª½í™” ğŸŒ™ AI ê¿ˆ í•´ëª½</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');

        body {
            font-family: "Pretendard", sans-serif;
            background: linear-gradient(180deg, #f4f1ff 0%, #fafafa 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 80px 20px 40px;
            color: #333;
            overflow-x: hidden;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            color: #5e4ae3;
            text-shadow: 0 2px 6px rgba(94, 74, 227, 0.2);
            margin-bottom: 30px;
        }

        strong, b {
            font-weight: 700 !important;
            color: #333;
        }

        .card {
            width: 80%;
            max-width: 800px;
            background: #fff;
            border-radius: 20px;
            padding: 32px 28px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            margin-top: 50px;
            box-sizing: border-box;
        }

        textarea {
            width: 100%;
            height: 120px;
            font-size: 15px;
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid #ccc;
            resize: none;
            outline: none;
            box-sizing: border-box;
        }

        /* âœ… 5ê°œ ë²„íŠ¼ì„ í•œ ì¤„ì— ê· ë“± ë°°ì¹˜ */
        .style-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 14px;
        }

        .style-btn {
            padding: 10px 0;
            border-radius: 10px;
            border: 1px solid #ccc;
            background: #f8f8ff;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.2s ease;
        }

        .style-btn:hover {
            background: #ebe7ff;
        }

        .style-btn.active {
            background-color: #5e4ae3;
            color: white;
            border-color: #5e4ae3;
        }

        button.start-btn {
            width: 100%;
            border-radius: 10px;
            font-size: 15px;
            margin-top: 24px;
            padding: 12px;
            background-color: #5e4ae3;
            color: white;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        button.start-btn:hover {
            background-color: #4b3acb;
        }

        /* âœ… ê²°ê³¼ ë°•ìŠ¤ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€ ìƒíƒœ) */
        .result-section {
            width: 80%;
            max-width: 800px;
            background: #fff;
            border-radius: 20px;
            padding: 28px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            line-height: 1.7;
            box-sizing: border-box;
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        /* âœ… ë²„íŠ¼ í´ë¦­ ì‹œ ë‚˜íƒ€ë‚˜ëŠ” ìƒíƒœ */
        .result-section.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .result-section h2 {
            font-size: 1.3rem;
            color: #5e4ae3;
            margin-bottom: 8px;
        }

        .divider {
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, #d6cbff, #f4f1ff);
            border: none;
            margin: 10px 0 20px;
        }

        #result {
            white-space: pre-line;
            margin-bottom: 20px;
        }

        #imageContainer img {
            width: 100%;
            border-radius: 16px;
            box-shadow: 0 4px 18px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transition: opacity 1.2s ease-in;
        }

        #imageContainer img.show {
            opacity: 1;
        }

        footer {
            margin-top: 40px;
            font-size: 13px;
            color: #999;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.0.0/dist/markdown-it.min.js"></script>
</head>
<body>
<h1>ëª½í™” ğŸŒ™</h1>

<!-- ì…ë ¥ ì¹´ë“œ -->
<div class="card">
    <h3>ë‚˜ì˜ ê¿ˆ ì…ë ¥</h3>
    <textarea id="dreamInput" placeholder="ex) ì‚¬ê³¼ë‚˜ë¬´ì— ìœ ë… ë¹›ë‚˜ëŠ” í™©ê¸ˆ ì‚¬ê³¼ê°€ í•˜ë‚˜ ìˆì—ˆëŠ”ë° ê·¸ê±¸ ë”°ëŠ” ê¿ˆì„ ê¿¨ì–´"></textarea>

    <h3 style="margin-top:24px;">AI ì´ë¯¸ì§€ í™”í’ ì„ íƒ</h3>
    <div class="style-buttons">
        <button class="style-btn active" data-style="ìˆ˜ì±„í™”">ğŸ¨ ìˆ˜ì±„í™”í’</button>
        <button class="style-btn" data-style="ì• ë‹ˆë©”ì´ì…˜">ğŸ–¼ ì• ë‹ˆë©”ì´ì…˜í’</button>
        <button class="style-btn" data-style="ì‚¬ì´ë²„í‘í¬">ğŸŒŒ ì‚¬ì´ë²„í‘í¬</button>
        <button class="style-btn" data-style="í”½ì…€ì•„íŠ¸">ğŸŒ  í”½ì…€ì•„íŠ¸</button>
    </div>

    <button class="start-btn" onclick="sendDream()">ì‹œì‘í•˜ê¸°</button>
</div>

<!-- ê²°ê³¼ ì¹´ë“œ -->
<div id="resultBox" class="result-section">
    <h2>í•´ëª½ ê²°ê³¼</h2>
    <hr class="divider" />
    <div id="result">ê¿ˆì„ ì…ë ¥í•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš” ğŸŒ™</div>

    <h2 id="imageTitle">AI ì´ë¯¸ì§€</h2>
    <hr class="divider" />
    <div id="imageContainer"></div>
</div>

<footer>Â© 2025 ëª½í™”(Monghwa) | AI Dream Interpretation</footer>

<script>
    const md = window.markdownit({ breaks: true });
    let selectedStyle = "ìˆ˜ì±„í™”";

    // âœ… í™”í’ ë²„íŠ¼ ì„ íƒ ì´ë²¤íŠ¸
    document.querySelectorAll(".style-btn").forEach(btn => {
        btn.addEventListener("click", () => {
            document.querySelectorAll(".style-btn").forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
            selectedStyle = btn.dataset.style;
        });
    });

    async function sendDream() {
        const dreamText = document.getElementById("dreamInput").value.trim();
        const resultEl = document.getElementById("result");
        const imageContainer = document.getElementById("imageContainer");
        const imageTitle = document.getElementById("imageTitle");
        const resultBox = document.getElementById("resultBox");

        if (!dreamText) return alert("ğŸŒ™ ê¿ˆ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

        // âœ… ê²°ê³¼ ë°•ìŠ¤ í‘œì‹œ (ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ ë“±ì¥)
        resultBox.classList.add("show");

        resultEl.textContent = "AIê°€ ê¿ˆì„ í•´ì„ ì¤‘ì…ë‹ˆë‹¤... â³";
        imageContainer.innerHTML = "";

        try {
            const res = await fetch("http://localhost:8080/api/dream", {
                method: "POST",
                headers: { "Content-Type": "text/plain; charset=utf-8" },
                body: dreamText,
            });
            const text = await res.text();
            resultEl.innerHTML = md.render(text);

            imageTitle.textContent = `${selectedStyle}í’ ê¿ˆ AI ì´ë¯¸ì§€`;

            const waitMsg = document.createElement("p");
            waitMsg.textContent = `ğŸŒ™ ${selectedStyle} ìŠ¤íƒ€ì¼ë¡œ ì‹œê°í™” ì¤‘ì…ë‹ˆë‹¤... ğŸ¨`;
            waitMsg.style.marginTop = "10px";
            imageContainer.appendChild(waitMsg);

            const imgRes = await fetch("http://localhost:8080/api/dream/image", {
                method: "POST",
                headers: { "Content-Type": "application/json; charset=utf-8" },
                body: JSON.stringify({ text: dreamText, style: selectedStyle }),
            });

            const imageData = await imgRes.text();
            if (imageData.startsWith("data:image")) {
                const img = document.createElement("img");
                img.src = imageData;
                img.onload = () => img.classList.add("show");
                imageContainer.innerHTML = "";
                imageContainer.appendChild(img);
            } else {
                imageContainer.textContent = "âš ï¸ ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨: " + imageData;
            }

            // âœ… ê²°ê³¼ê°€ ìƒì„±ë˜ë©´ ìë™ ìŠ¤í¬ë¡¤ ì•„ë˜ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™
            resultBox.scrollIntoView({ behavior: "smooth" });

        } catch (e) {
            resultEl.textContent = "âš ï¸ ì˜¤ë¥˜ ë°œìƒ: " + e.message;
        }
    }
</script>
</body>
</html>
